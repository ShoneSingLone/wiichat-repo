const fs = require("fs");
const fsPromises = require("fs").promises;
const path = require("path");


function deleteFile(pathString) {
	/* 存在 */
	if (fs.existsSync(pathString)) {
		/* 目录递归删除 */
		if (fs.statSync(pathString).isDirectory()) {
			fs.readdirSync(pathString).forEach((file) => deleteFile(path.resolve(pathString, file)));
			fs.rmdirSync(pathString);
		} else {
			/* 文件直接删除 */
			fs.unlinkSync(pathString);
		}
	}
}

(async () => {
	const modules = await fsPromises.readdir(path.resolve("./packages"));
	modules.forEach(async dir_name => {
		["package-lock.json", "node_modules", "yarn.lock"].forEach(async targetName => {
			const curPath = path.resolve("./packages", dir_name, targetName);
			try {
				deleteFile(curPath);
			} catch (error) {
				console.error(error);
			} finally {
				console.log(dir_name,targetName);
			}
		});
	});
})();