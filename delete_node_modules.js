const fs = require("fs");
const fsPromises = require("fs").promises;

const path = require("path");


function deleteFile(pathString) {
	var files = [];
	if (/@ventose/gi.test(pathString)) return;
	if (fs.existsSync(pathString)) {
		files = fs.readdirSync(pathString);
		files.forEach((file) => {
			var curPath = path.resolve(pathString, file);
			deleteFile(curPath);
		});

		if (fs.statSync(pathString).isDirectory()) {
			fs.rmdirSync(pathString);
		} else {
			fs.unlinkSync(pathString);
		}
	} 
}


(async () => {
	const modules = await fsPromises.readdir(path.resolve("./packages"));
	modules.forEach(async dir_name => {
		["package-lock.json", "node_modules", "yarn.lock"].forEach(async targetName => {
			const curPath = path.resolve("./packages", dir_name, targetName);
			try {
				deleteFile(curPath);
			} catch (error) {
				console.error(`error : /${error}`);
			} finally {
				console.log(`current : ${curPath}`);
			}
		});
	});
})();